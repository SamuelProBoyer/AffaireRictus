<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/img/blobanimation.svg" />

    <title>Quiz Rictus</title>

    <!-- <link rel="stylesheet" href="style.css" /> -->
  </head>
  <body>
    <h1 id="title">Quiz Rictus</h1>
    <h2 id="username"></h2>
    <button id="btn-connexion">Se connecter</button>
    <div id="quiz-container">
      <div id="question-container">
        <p id="question"></p>
        <ul id="options">
          <li><button class="option-btn"></button></li>
          <li><button class="option-btn"></button></li>
        </ul>
      </div>
      <div id="feedback-container">
        <p id="feedback"></p>
      </div>
      <button id="next-btn">Suivant</button>
      <p id="score">Score: 0</p>
      <button id="sign-out-btn">Se déconnecter</button>
    </div>
    <audio id="correct-sound" src="../audio/correct_sound.mp3"></audio>
    <audio id="wrong-sound" src="../audio/error_sound.wav"></audio>
    <script type="module">
      // Initialize Firebase
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
      import {
        getAuth,
        signInWithPopup,
        GoogleAuthProvider,
        signOut,
      } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-auth.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCgL7qiacZTLcw19bgMAbfQEUCsyow8gOQ",
        authDomain: "affairerictus.firebaseapp.com",
        projectId: "affairerictus",
        storageBucket: "affairerictus.appspot.com",
        messagingSenderId: "625025844556",
        appId: "1:625025844556:web:d65766db87163734e0fbe9",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
    //   console.log(app);

      var questionElement = document.getElementById("question");
      var usernameElement = document.getElementById("username");
      var btnConnexion = document.getElementById("btn-connexion");
      var quizContainer = document.getElementById("quiz-container");
      var title = document.getElementById("title");
      var optionsElement = document.getElementById("options");
      var feedbackElement = document.getElementById("feedback");
      var nextButton = document.getElementById("next-btn");
      var scoreElement = document.getElementById("score");
      var signOutButton = document.getElementById("sign-out-btn");

      var currentQuestionIndex = 0;
      var score = 0;

      var correctSound = new Audio("../audio/correct_sound.mp3");
      var wrongSound = new Audio("../audio/error_sound.wav");

      // Check if user is signed in with Google
      const provider = new GoogleAuthProvider();
      var auth = getAuth();
      quizContainer.style.display = "none";
      //   var user = auth;
      btnConnexion.addEventListener("click", () => {
          signInWithPopup(auth, provider)
          .then((result) => {
              const credential = GoogleAuthProvider.credentialFromResult(result);
              const token = credential.accessToken;
              const user = result.user;
              quizContainer.style.display = "block";
              usernameElement.innerHTML = user.displayName;
              console.log(user);
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                const email = error.customData.email;
                const credential = GoogleAuthProvider.credentialFromError(error);
                // ...
            });
        });

      signOutButton.addEventListener("click", function () {
        signOut(auth)
          .then(() => {
            // Sign-out successful.
            quizContainer.style.display = "none";
            usernameElement.innerHTML = "";
            console.log("yepo");
          })
          .catch((error) => {
            // An error happened.
            console.log("nopo");
          });
      });

      var questions = [
        {
          question: "Question 1: Qu’est-ce que signifie le mot “rictus”",
          options: ["Une ouverture de la bouche", "Un mouvemenent musculaire"],
          answer: "Une ouverture de la bouche",
        },
        {
          question:
            "Question 2: Est-ce que le rictus représente les mêmes émotions que le sourire ?",
          options: ["Oui", "Non"],
          answer: "Non",
        },
        {
          question: "Question 3: Quel type de maladie est le rictus ?",
          options: [
            "Une maladie musculaire",
            "Une anomalie faciale",
            "Ce n'est pas une maladie",
          ],
          answer: "Ce n'est pas une maladie",
        },
        {
          question:
            "Question 4: Est-ce que les rictus sont toujours involontaires",
          options: ["Oui", "Non"],
          answer: "Non",
        },
        {
          question:
            "Question 5: Pour quel référence le documentaire se nomme rictus ?",
          options: [
            "En référence à un docteur",
            "En référence à la mère du créateur",
            "En référence au personnage d’un comics du même nom",
          ],
          answer: "En référence au personnage d’un comics du même nom",
        },
      ];
        
            function loadQuestion() {
              feedbackElement.textContent = "";
              var currentQuestion = questions[currentQuestionIndex];
              questionElement.textContent = currentQuestion.question;
              optionsElement.innerHTML = "";
              for (var i = 0; i < currentQuestion.options.length; i++) {
                var optionButton = document.createElement("button");
                optionButton.classList.add("option-btn");
                optionButton.textContent = currentQuestion.options[i];
                optionsElement.appendChild(optionButton);
                optionButton.addEventListener("click", checkAnswer);
              }
            }
      
            function checkAnswer(event) {
              var selectedOption = event.target.textContent;
              var currentQuestion = questions[currentQuestionIndex];
              if (selectedOption === currentQuestion.answer) {
                feedbackElement.textContent = "Bravo !";
                score++;
                scoreElement.innerHTML = "Score: " + score;
                correctSound.play();
              } else {
                feedbackElement.textContent = "Et non...";
                wrongSound.play();
              }
              var optionButtons = optionsElement.querySelectorAll(".option-btn");
              for (var i = 0; i < optionButtons.length; i++) {
                optionButtons[i].disabled = true;
              }
              nextButton.disabled = false;
            }
      
            function nextQuestion() {
              currentQuestionIndex++;
              if (currentQuestionIndex < questions.length) {
                loadQuestion();
              } else {
                endQuiz();
              }
            }
      
            function endQuiz() {
              questionElement.textContent = "Quiz terminé !";
              optionsElement.innerHTML = "";
              feedbackElement.textContent = "";
              scoreElement.textContent = "Pointage : " + score;
              nextButton.disabled = true;
            }
      
            nextButton.addEventListener("click", nextQuestion);
      
            loadQuestion();
      
    </script>
  </body>
</html>
